(function(a){var b={};a.GearsRuntime=a.addRuntime("gears",{init:function(c,d){if(!window.google||!google.gears){d({success:false});return}c.bind("UploadFile",function(e,i){var h=0,k,j,g=0;j=e.settings.chunk_size;k=Math.ceil(i.size/j);f();function f(){var l=e.settings.url,m,n;if(i.status==a.DONE||i.status==a.FAILED||e.state==a.STOPPED){return}n=Math.min(j,i.size-(h*j));m=google.gears.factory.create("beta.httprequest");m.open("POST",l+(l.indexOf("?")==-1?"?":"&")+"name="+escape(i.target_name||i.name)+"&chunk="+h+"&chunks="+k);m.setRequestHeader("Content-Disposition",'attachment; filename="'+i.name+'"');m.setRequestHeader("Content-Type","application/octet-stream");m.upload.onprogress=function(o){i.loaded=g+o.loaded;e.trigger("UploadProgress",i)};m.onreadystatechange=function(){var o;if(m.readyState==4){if(m.status==200){o={file:i,chunk:h,chunks:k,response:m.responseText};e.trigger("ChunkUploaded",o);if(o.cancelled){i.status=a.FAILED;e.trigger("FileUploaded",i);return}g+=n;if(++h>=k){i.status=a.DONE;e.trigger("FileUploaded",i)}else{f()}}else{e.trigger("UploadChunkError",{file:i,chunk:h,chunks:k,error:"Status: "+m.status})}}};if(h<k){m.send(b[i.id].slice(h*j,n))}}});c.bind("SelectFiles",function(e){var g=google.gears.factory.create("beta.desktop"),j=[],h,f;for(h=0;h<e.settings.filters.length;h++){ext=e.settings.filters[h].extensions.split(",");for(f=0;f<ext.length;f++){j.push("."+ext[f])}}g.openFiles(function(m){var l,k,n=[],o;for(k=0;k<m.length;k++){l=m[k];o=a.guid();b[o]=l.blob;n.push(new a.File(o,l.name,l.blob.length))}c.trigger("FilesSelected",n)},{singleFile:!e.settings.multi_selection,filter:j})});d({success:true})}})})(plupload);