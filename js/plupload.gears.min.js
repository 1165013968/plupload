(function(a){var b={};a.GearsRuntime=a.addRuntime("gears",{isSupported:function(){return !!(window.google&&google.gears)},init:function(c){c.bind("UploadFile",function(d,h){var g=0,j,i,f=0;i=d.settings.chunk_size;j=Math.ceil(h.size/i);e();function e(){var k=d.settings.url,l,m;if(h.status==a.DONE||h.status==a.FAILED||d.state==a.STOPPED){return}m=Math.min(i,h.size-(g*i));l=google.gears.factory.create("beta.httprequest");l.open("POST",k+(k.indexOf("?")==-1?"?":"&")+"name="+escape(h.target_name||h.name)+"&chunk="+g+"&chunks="+j);l.setRequestHeader("Content-Disposition",'attachment; filename="'+h.name+'"');l.setRequestHeader("Content-Type","application/octet-stream");l.upload.onprogress=function(n){h.loaded=f+n.loaded;d.trigger("UploadProgress",h)};l.onreadystatechange=function(){var n;if(l.readyState==4){if(l.status==200){n={file:h,chunk:g,chunks:j,response:l.responseText};d.trigger("ChunkUploaded",n);if(n.cancelled){h.status=a.FAILED;d.trigger("FileUploaded",h);return}f+=m;if(++g>=j){h.status=a.DONE;d.trigger("FileUploaded",h)}else{e()}}else{d.trigger("UploadChunkError",{file:h,chunk:g,chunks:j,error:"Status: "+l.status})}}};if(g<j){l.send(b[h.id].slice(g*i,m))}}});c.bind("SelectFiles",function(d){var f=google.gears.factory.create("beta.desktop"),h=[],g,e;for(g=0;g<d.settings.filters.length;g++){ext=d.settings.filters[g].extensions.split(";");for(e=0;e<ext.length;e++){h.push(ext[e].replace(/^[^.]+\./,"."))}}f.openFiles(function(l){var k,j,m=[],n;for(j=0;j<l.length;j++){k=l[j];n=a.guid();b[n]=k.blob;m.push(new a.File(n,k.name,k.blob.length))}c.trigger("FilesSelected",m)},{singleFile:!d.settings.multi_selection,filter:h})})}})})(plupload);