(function(b){var c={};function a(f,i,d,k,j){var i,d,e,g,h;g=google.gears.factory.create("beta.canvas");g.decode(f);scale=Math.min(i/g.width,d/g.height);if(scale<1){i=Math.round(g.width*scale);d=Math.round(g.height*scale)}else{i=g.width;d=g.height}g.resize(i,d);return g.encode(j,{quality:k/100})}b.GearsRuntime=b.addRuntime("gears",{init:function(e,g){var f;if(!window.google||!google.gears){g({success:false});return}f=google.gears.factory.create("beta.desktop");function d(k){var j,h,l=[],m;for(h=0;h<k.length;h++){j=k[h];m=b.guid();c[m]=j.blob;l.push(new b.File(m,j.name,j.blob.length))}e.trigger("FilesSelected",l)}e.bind("PostInit",function(){var h=document.getElementById(e.settings.drop_element);b.addEvent(h,"dragover",function(i){i.preventDefault()});b.addEvent(h,"drop",function(j){var i=f.getDragData(j,"application/x-gears-files");if(i){d(i.files)}j.preventDefault()});h=0});e.bind("UploadFile",function(l,i){var p=0,m,j,k=0,o,n;o=l.settings.image_width;n=l.settings.image_height;j=l.settings.chunk_size;m=Math.ceil(i.size/j);if(/\.(png|jpg|jpeg)$/i.test(i.name)&&(o||n)){c[i.id]=a(c[i.id],o,n,l.settings.image_quality,/\.png$/i.test(i.name)?"image/png":"image/jpeg")}i.size=c[i.id].length;h();function h(){var q=l.settings.url,r,s;if(i.status==b.DONE||i.status==b.FAILED||l.state==b.STOPPED){return}s=Math.min(j,i.size-(p*j));r=google.gears.factory.create("beta.httprequest");r.open("POST",q+(q.indexOf("?")==-1?"?":"&")+"name="+escape(i.target_name||i.name)+"&chunk="+p+"&chunks="+m);r.setRequestHeader("Content-Disposition",'attachment; filename="'+i.name+'"');r.setRequestHeader("Content-Type","application/octet-stream");r.upload.onprogress=function(t){i.loaded=k+t.loaded;l.trigger("UploadProgress",i)};r.onreadystatechange=function(){var t;if(r.readyState==4){if(r.status==200){t={file:i,chunk:p,chunks:m,response:r.responseText};l.trigger("ChunkUploaded",t);if(t.cancelled){i.status=b.FAILED;l.trigger("FileUploaded",i);return}k+=s;if(++p>=m){i.status=b.DONE;l.trigger("FileUploaded",i)}else{h()}}else{l.trigger("UploadChunkError",{file:i,chunk:p,chunks:m,error:"Status: "+r.status})}}};if(p<m){r.send(c[i.id].slice(p*j,s))}}});e.bind("SelectFiles",function(h){var m=[],k,j,l;for(k=0;k<h.settings.filters.length;k++){l=h.settings.filters[k].extensions.split(",");for(j=0;j<l.length;j++){m.push("."+l[j])}}f.openFiles(d,{singleFile:!h.settings.multi_selection,filter:m})});g({success:true})}})})(plupload);