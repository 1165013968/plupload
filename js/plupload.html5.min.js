(function(b){var c=true;function a(i,l,j,d,k){var f,e,h,g;f=document.createElement("canvas");f.style.display="none";document.body.appendChild(f);e=f.getContext("2d");h=new Image();h.onload=function(){var o,m,n;scale=Math.min(l/h.width,j/h.height);if(scale<1){o=Math.round(h.width*scale);m=Math.round(h.height*scale)}else{o=h.width;m=h.height}f.width=o;f.height=m;e.drawImage(h,0,0,o,m);g=f.toDataURL(d);g=g.substring(g.indexOf("base64,")+7);g=atob(g);f.parentNode.removeChild(f);k({success:true,data:g})};h.src=i}b.runtimes.Html5=b.addRuntime("html5",{init:function(h,i){var d={},f;function g(m){var k,j,l=[],n;for(j=0;j<m.length;j++){k=m[j];n=b.guid();d[n]=k;l.push(new b.File(n,k.fileName,k.fileSize))}h.trigger("FilesAdded",l)}function e(){var j;if(window.XMLHttpRequest){j=new XMLHttpRequest();return !!(j.sendAsBinary||j.upload)}return false}if(!e()){i({success:false});return}h.bind("Init",function(k){var q,j=[],l,p,o=k.settings.filters,n,m;q=document.createElement("div");q.id=k.id+"_html5_container";for(l=0;l<o.length;l++){n=o[l].extensions.split(/,/);for(p=0;p<n.length;p++){m=b.mimeTypes[n[p]];if(m){j.push(m)}}}b.extend(q.style,{position:"absolute",background:h.settings.html5_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",opacity:0});q.className="plupload_html5";document.body.appendChild(q);q.innerHTML='<input id="'+h.id+'_html5" style="width:100%;" type="file" accept="'+j.join(",")+'" '+(h.settings.multi_selection?'multiple="multiple"':"")+" />";document.getElementById(h.id+"_html5").onchange=function(){g(this.files);this.value=""}});h.bind("PostInit",function(){var j=document.getElementById(h.settings.drop_element);if(j){b.addEvent(j,"dragover",function(k){k.preventDefault()});b.addEvent(j,"drop",function(l){var k=l.dataTransfer;if(k&&k.files){g(k.files)}l.preventDefault()})}});h.bind("Refresh",function(j){var k,l;k=document.getElementById(h.settings.browse_button);l=b.getPos(k);b.extend(document.getElementById(h.id+"_html5_container").style,{top:l.y+"px",left:l.x+"px",width:k.offsetWidth+"px",height:k.offsetHeight+"px"})});h.bind("UploadFile",function(k,o){var q=new XMLHttpRequest(),n,m=k.settings.url,l,j,p;if(o.status==b.DONE||o.status==b.FAILED||k.state==b.STOPPED){return}if(n=q.upload){n.onload=function(){o.status=b.DONE;k.trigger("FileUploaded",o)};n.onprogress=function(r){o.loaded=r.loaded;k.trigger("UploadProgress",o)}}q.onreadystatechange=function(){if(q.readyState==4){o.status=b.DONE;o.loaded=o.size;k.trigger("UploadProgress",o);k.trigger("FileUploaded",o)}};q.open("post",m+(m.indexOf("?")==-1?"?":"&")+"name="+escape(o.target_name||o.name),true);q.setRequestHeader("Content-Type","application/octet-stream");p=d[o.id];if(q.sendAsBinary){l=k.settings.image_width;j=k.settings.image_height;if(/\.(png|jpg|jpeg)$/i.test(o.name)&&(l||j)){a(p.getAsDataURL(),l,j,/\.png$/i.test(o.name)?"image/png":"image/jpeg",function(r){if(r.success){o.size=r.data.length;q.sendAsBinary(r.data)}else{q.sendAsBinary(p.getAsBinary())}})}else{q.sendAsBinary(p.getAsBinary())}}else{q.send(p)}});f=!!(File&&File.prototype.getAsDataURL);h.features={dragdrop:window.mozInnerScreenX!==undefined,jpgresize:f,pngresize:f};i({success:c})}})})(plupload);