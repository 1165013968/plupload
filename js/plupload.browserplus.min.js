(function(a){a.BrowserPlusRuntime=a.addRuntime("browserplus",{init:function(f,h){var e=window.BrowserPlus,g={},d,c;d=f.settings.image_width;c=f.settings.image_height;if(e){e.init(function(j){var i=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"}];if(d||c){i.push({service:"ImageAlter",version:"4"})}if(j.success){e.require({services:i},function(){if(j.success){b()}else{h()}})}else{h()}})}else{h()}function b(){f.bind("SelectFiles",function(j){var n=[],l,k,o=j.settings.filters,m;for(l=0;l<o.length;l++){m=o[l].extensions.split(",");for(k=0;k<m.length;k++){n.push(a.mimeTypes[m[k]])}}e.FileBrowse.OpenBrowseDialog({mimeTypes:n},function(s){var t,r,p=[],q,u;if(s.success){t=s.value;for(r=0;r<t.length;r++){q=t[r];u=a.guid();g[u]=q;p.push(new a.File(u,q.name,q.size))}f.trigger("FilesSelected",p)}})});f.bind("UploadFile",function(i,k){var j=i.settings.url,m=g[k.id];function l(n){k.size=n.size;e.Uploader.upload({url:j+(j.indexOf("?")==-1?"?":"&")+"&multipart=true&name="+escape(k.target_name||k.name),files:{file:n},cookies:document.cookies,progressCallback:function(o){k.loaded=o.fileSent;i.trigger("UploadProgress",k)}},function(o){if(o.success){k.status=a.DONE;i.trigger("FileUploaded",k)}})}if(/\.(png|jpg|jpeg)$/i.test(k.name)&&(d||c)){BrowserPlus.ImageAlter.transform({file:m,quality:i.settings.image_quality,actions:[{scale:{maxwidth:d,maxheight:c}}]},function(n){if(n.success){l(n.value.file)}})}else{l(m)}});h({success:true})}}})})(plupload);