(function(a){var b=true,c=false;a.runtimes.BrowserPlus=a.addRuntime("browserplus",{init:function(i,l){var f=window.BrowserPlus,e={},k,j,h=i.settings;k=h.image_width;j=h.image_height;function d(q){var p,o,m=[],n,r;for(o=0;o<q.length;o++){n=q[o];r=a.guid();e[r]=n;m.push(new a.File(r,n.name,n.size))}if(o){i.trigger("FilesAdded",m)}}if(f){f.init(function(n){var m=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"}];if(k||j){m.push({service:"ImageAlter",version:"4"})}if(n.success){f.require({services:m},function(){if(n.success){g()}else{l()}})}else{l()}})}else{l()}function g(){i.bind("PostInit",function(){var p,n=h.drop_element,r=i.id+"_droptarget",m=document.getElementById(n),o;if(m){function s(u,t){f.DragAndDrop.AddDropTarget({id:u},function(v){f.DragAndDrop.AttachCallbacks({id:u,hover:function(w){if(!w&&t){t()}},drop:function(w){if(t){t()}d(w)}},function(){})})}if(document.attachEvent&&(/MSIE/gi).test(navigator.userAgent)){p=document.createElement("div");p.setAttribute("id",r);a.extend(p.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0});document.body.appendChild(p);a.addEvent(m,"dragenter",function(u){var t,v;t=document.getElementById(n);v=a.getPos(t);a.extend(document.getElementById(r).style,{top:v.y+"px",left:v.x+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})});function q(){document.getElementById(r).style.top="-1000px"}s(r,q)}else{s(n)}a.addEvent(document.getElementById(h.browse_button),"click",function(y){var w=[],u,t,x=h.filters,v;y.preventDefault();for(u=0;u<x.length;u++){v=x[u].extensions.split(",");for(t=0;t<v.length;t++){w.push(a.mimeTypes[v[t]])}}f.FileBrowse.OpenBrowseDialog({mimeTypes:w},function(z){if(z.success){d(z.value)}})});m=dropTarget=0}});i.bind("UploadFile",function(m,o){var n=m.settings.url,q=e[o.id];function p(r){o.size=r.size;f.Uploader.upload({url:n+(n.indexOf("?")==-1?"?":"&")+"&multipart=true&name="+escape(o.target_name||o.name),files:{file:r},cookies:document.cookies,progressCallback:function(s){o.loaded=s.fileSent;m.trigger("UploadProgress",o)}},function(s){if(s.success){o.status=a.DONE;m.trigger("FileUploaded",o)}})}if(/\.(png|jpg|jpeg)$/i.test(o.name)&&(k||j)){BrowserPlus.ImageAlter.transform({file:q,quality:m.settings.image_quality,actions:[{scale:{maxwidth:k,maxheight:j}}]},function(r){if(r.success){p(r.value.file)}})}else{p(q)}});i.features={dragdrop:b,jpgresize:b,pngresize:b,chunks:c};l({success:b})}}})})(plupload);